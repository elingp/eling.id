---

import { Icon } from "astro-icon/components";
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<header class="group relative mb-12 flex items-center lg:ps-18" id="main-header">
	<div class="flex lg:flex-col">
		<a
			aria-current={Astro.url.pathname === "/" ? "page" : false}
			class="focus-visible:ring-accent inline-flex items-center rounded-md focus-visible:ring-2 focus-visible:outline-none active:filter-none lg:relative lg:inline-block"
			href="/"
		>
			<svg
				aria-hidden="true"
				class="fill-accent me-1 h-11 w-11 lg:absolute lg:-start-18 lg:me-0 lg:h-14 lg:w-14"
				focusable="false"
				viewBox="0 0 500 500"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					transform="translate(0,500) scale(0.1,-0.1)"
					d="M1121 4319 c-179 -21 -347 -163 -402 -340 -18 -58 -19 -115 -19 -1479 0 -1361 1 -1421 19 -1479 26 -84 59 -137 127 -202 70 -66 128 -101 209 -126 56 -17 114 -18 865 -18 l805 0 71 22 c181 57 315 206 343 383 7 40 11 287 11 642 l0 577 383 3 c370 4 384 4 445 27 126 46 242 160 294 289 l23 57 3 614 c2 530 0 621 -13 674 -21 80 -55 138 -129 215 -82 86 -169 128 -291 142 -111 12 -2637 11 -2744 -1z m2579 -1009 l0 -410 -362 0 c-408 0 -450 -5 -549 -66 -79 -47 -155 -134 -198 -224 l-36 -75 -3 -627 -3 -628 -624 0 -625 0 0 509 0 509 333 4 332 3 60 28 c102 48 155 115 174 220 24 131 -38 256 -156 317 -64 33 -143 40 -455 40 l-288 0 0 405 0 405 1200 0 1200 0 0 -410z"
				></path>
			</svg>
			<span class="font-sans text-lg/5 font-extrabold md:text-3xl">Eling Pramuatmaja</span>
		</a>
		<nav aria-label="Main menu">
			<ul
				class="bg-global-bg divide-accent absolute -inset-x-4 top-14 hidden flex-col divide-y px-2 py-4 group-[.menu-open]:z-50 group-[.menu-open]:flex lg:static lg:z-auto lg:-ms-4 lg:mt-1 lg:flex lg:flex-row lg:divide-x lg:divide-y-0 lg:divide-dotted lg:bg-transparent lg:p-0"
				id="navigation-menu"
			>
				{menuLinks.map((link) => (
						<li>
							<a
								aria-current={Astro.url.pathname === link.path ? "page" : false}
								class="text-global-text lg:text-accent flex items-center justify-between px-2 py-4 font-semibold hover:underline focus-visible:underline focus-visible:underline-offset-2 focus-visible:outline-none lg:px-4 lg:py-0 lg:text-lg lg:underline-offset-2"
								href={link.path}
							>
								{link.title}<Icon
									aria-hidden="true"
									name="fa7-solid:chevron-right"
									class="ms-auto h-3 w-3 lg:hidden"
								/>
							</a>
						</li>
					))}
			</ul>
		</nav>
	</div>
	<Search />
	<ThemeToggle />
	<mobile-button class="inline-flex">
		<button
			aria-controls="navigation-menu"
			aria-expanded="false"
			class="group focus-visible:ring-accent relative ms-2 h-9 w-9 rounded-md focus-visible:ring-2 focus-visible:outline-none lg:invisible lg:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<span class="sr-only">Open main menu</span>
			<Icon
				aria-hidden="true"
				name="fa7-solid:navicon"
				title="Open menu"
				class="hover:text-accent absolute start-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 cursor-pointer transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
			/>
			<Icon
				aria-hidden="true"
				name="fa7-solid:close"
				title="Close menu"
				class="text-accent absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 cursor-pointer opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
			/>
		</button>
	</mobile-button>
</header>

<script>
	class MobileNavBtn extends HTMLElement {
		#menuOpen: boolean = false;

		connectedCallback() {
			const headerEl = document.getElementById("main-header");
			const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");
			const menuEl = document.getElementById("navigation-menu");
			const srLabel = mobileButtonEl?.querySelector(".sr-only");
			const firstMenuLink = menuEl?.querySelector<HTMLAnchorElement>("a");

			const setMenuState = (open: boolean) => {
				headerEl?.classList.toggle("menu-open", open);
				this.#menuOpen = open;
				mobileButtonEl?.setAttribute("aria-expanded", String(open));
				if (srLabel) {
					srLabel.textContent = open ? "Close main menu" : "Open main menu";
				}
				if (open) {
					firstMenuLink?.focus();
				} else {
					mobileButtonEl?.focus();
				}
			};

			mobileButtonEl?.addEventListener("click", () => {
				setMenuState(!this.#menuOpen);
			});

			menuEl?.addEventListener("click", (event) => {
				const target = event.target as HTMLElement | null;
				if (this.#menuOpen && target?.closest("a")) {
					setMenuState(false);
				}
			});

			document.addEventListener("keydown", (event) => {
				if (event.key === "Escape" && this.#menuOpen) {
					setMenuState(false);
				}
			});
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
