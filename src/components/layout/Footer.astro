---
import ExternalLink from "@/components/ExternalLink.astro";
import { menuLinks, siteConfig } from "@/site.config";

interface Props {
	sourcePath?: string;
}

const { sourcePath } = Astro.props;

const footerMenuLinks = [...menuLinks, { title: "RSS", path: "/rss.xml" }];

const year = new Date().getFullYear();
const githubRepo = "elingp/eling.id";
const commitHash = import.meta.env.PUBLIC_COMMIT_HASH || "dev";
const shortHash = commitHash.slice(0, 7);

const branch = commitHash === "dev" ? "dev" : "main";
const encodedPath = sourcePath ? encodeURI(sourcePath) : "";
const sourceUrl = encodedPath
	? `https://github.com/${githubRepo}/blob/${branch}/${encodedPath}`
	: `https://github.com/${githubRepo}`;
---

<footer
	class="text-muted mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-8 text-center align-top font-sans text-sm font-medium sm:flex-row sm:justify-between sm:text-xs"
>
	<p class="me-0 sm:me-4">
		&copy; 2018â€“{year}
		{siteConfig.author}.
		<span class="inline-block"
			><ExternalLink
				class="hover:text-global-text focus-visible:underline focus-visible:outline-none"
				href={sourceUrl}
				title="View page source on GitHub"
				><span class="hover:underline">Page source</span></ExternalLink
			>. Build: <ExternalLink
				class="hover:text-global-text focus-visible:underline focus-visible:outline-none"
				href={`https://github.com/${githubRepo}/commit/${commitHash}`}
				title="View build commit on GitHub"
				><span class="font-mono hover:underline">{shortHash}</span></ExternalLink
			>
		</span>
	</p>
	<nav aria-label="Footer links">
		<ul class="sm:divide-global-text flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-dotted">
			{
				footerMenuLinks.map((link) => (
					<li>
						<a
							class="hover:text-global-text px-2 py-2 hover:underline focus-visible:underline focus-visible:outline-none sm:py-0"
							href={link.path}
						>
							{link.title}
						</a>
					</li>
				))
			}
		</ul>
	</nav>
</footer>
