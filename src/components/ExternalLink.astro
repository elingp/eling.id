---
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"a"> {
	href: string;
	newTab?: boolean;
	showNewTabHint?: boolean;
}

const {
	href,
	newTab,
	showNewTabHint = true,
	rel,
	target,
	class: className,
	...attrs
} = Astro.props;

const isHttpUrl = href.startsWith("http://") || href.startsWith("https://");
const isExternal = isHttpUrl && Astro.site ? new URL(href).origin !== Astro.site.origin : isHttpUrl;

const derivedNewTab = newTab ?? isExternal;
const relValue = derivedNewTab ? [rel, "noopener", "noreferrer"].filter(Boolean).join(" ") : rel;
const targetValue = derivedNewTab ? (target ?? "_blank") : target;
const slotContent = await Astro.slots.render("default");
const trimmedSlotContent = slotContent?.trim() ?? "";
---

<a {href} class={className} rel={relValue} target={targetValue} {...attrs}
	><Fragment set:html={trimmedSlotContent} />{
		derivedNewTab && showNewTabHint && <span class="sr-only">(opens in a new tab)</span>
	}</a
>
