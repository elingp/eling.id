---
import FormattedDate from "@/components/FormattedDate.astro";
import { menuLinks, siteConfig } from "@/site.config";

interface Props {
	sourcePath?: string;
}

const { sourcePath } = Astro.props;

const year = new Date().getFullYear();
const buildDate = new Date();
const githubRepo = "elingp/eling.id";
const commitHash = import.meta.env.PUBLIC_COMMIT_HASH || "dev";
const shortHash = commitHash.slice(0, 7);

const branch = commitHash === "dev" ? "dev" : "main";
const encodedPath = sourcePath ? encodeURI(sourcePath) : "";
const sourceUrl = encodedPath
	? `https://github.com/${githubRepo}/blob/${branch}/${encodedPath}`
	: `https://github.com/${githubRepo}`;
---

<footer
	class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-8 text-center align-top font-sans text-sm font-medium text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"
>
	<div class="me-0 sm:me-4">
		&copy; {year}
		{siteConfig.author}. <span class="inline-block">
			<a
				class="hover:text-global-text hover:underline"
				href="https://github.com/chrismwilliams/astro-theme-cactus"
				rel="noopener noreferrer"
				target="_blank">Based on Astro Cactus</a
			>.
		</span>
		<span class="inline-block"
			><a
				class="hover:text-global-text hover:underline"
				href={sourceUrl}
				rel="noopener noreferrer"
				target="_blank"
			>
				View source
			</a>Â·
		</span>
		<span class="inline-block"
			><a
				class="hover:text-global-text font-mono hover:underline"
				href={`https://github.com/${githubRepo}/commit/${commitHash}`}
				rel="noopener noreferrer"
				target="_blank"
				title="View commit on GitHub"
			>
				{shortHash}
			</a></span
		>
		<span class="inline-block"> (<FormattedDate date={buildDate} />)</span>
	</div>
	<nav
		aria-labelledby="footer_links"
		class="sm:divide-global-text flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-dotted"
	>
		{
			menuLinks.map((link) => (
				<a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href={link.path}>
					{link.title}
				</a>
			))
		}
	</nav>
</footer>
